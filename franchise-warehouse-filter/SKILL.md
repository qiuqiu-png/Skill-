---
name: franchise-warehouse-filter
description: 过滤和核算加盟入库单数据。自动剔除指定门店和时间范围的数据，剔除JMCX开头单据，仅保留足金类别。自动判断按件/按克，核算挂签费。支持宁波开元、慈溪附海、绍兴斗门等门店的过滤规则。
---

# 加盟入库单过滤与核算

自动过滤加盟入库单数据，并进行按件/按克判断和挂签费核算。

## 核心功能

1. **门店过滤**:
   - 剔除宁波开元门店（2025-01-01后）
   - 剔除慈溪附海门店（2025-04-25后）
   - 剔除绍兴斗门门店（全部年份）

2. **单据过滤**:
   - 剔除单据编码以"JMCX"开头的数据

3. **品类过滤**:
   - 仅保留大类为"足金"、"足金（新）"、"爱尚金"

4. **智能判断**:
   - 根据基础价判断按件/按克
   - 基础价不为空：按件
   - 基础价为空：按克

5. **挂签费核算**:
   - **按件产品**: 挂签费 = 基础价 × 0.04
   - **按克产品**:
     - 款式含"金条": 挂签费 = 总重 × 5
     - 款式含"笼统款"不含3D/5G: 挂签费 = 总重 × 13
     - 款式含"笼统款"含3D/5G: 挂签费 = 总重 × 28

## 使用方法

### 准备数据文件

需要准备加盟入库单Excel文件，必须包含以下列：
- 组织
- 创建时间
- 加盟收货单
- 大类
- 款式
- 基础价
- 总重

### 运行过滤

直接告诉Claude你要过滤加盟入库单，提供文件路径即可：

```
帮我过滤这个加盟入库单：/path/to/加盟入库单.xlsx
```

或者调用Skill：

```python
from scripts.filter_warehouse import filter_and_calculate

# 过滤并核算
result_path = filter_and_calculate(
    input_file="/path/to/加盟入库单.xlsx",
    output_file="/path/to/加盟入库单_已过滤.xlsx"
)
```

## 输出结果

输出的Excel文件包含：
- 原始所有列
- 新增列1: **按件/按克** - 判断结果
- 新增列2: **挂签费核算** - 核算金额

## 过滤规则说明

### 门店过滤规则

| 门店 | 过滤条件 | 说明 |
|------|---------|------|
| 宁波开元 | 创建时间 >= 2025-01-01 | 仅剔除2025年后的数据 |
| 慈溪附海 | 创建时间 >= 2025-04-25 | 仅剔除4月25日后的数据 |
| 绍兴斗门 | 全部 | 剔除所有年份的数据 |

### 单据过滤规则

剔除单据编码以"JMCX"开头的所有记录

### 品类保留规则

仅保留以下大类：
- 足金
- 足金（新）
- 爱尚金

## 挂签费核算示例

**按件产品示例**：
```
款式: 笼统款S（3D按件挂坠）
基础价: 970元
按件/按克: 按件
挂签费核算: 970 × 0.04 = 38.80元
```

**按克产品示例1（含3D/5G的笼统款）**：
```
款式: 笼统款S（5G耳饰）
总重: 3.04克
按件/按克: 按克
挂签费核算: 3.04 × 28 = 85.12元
```

**按克产品示例2（不含3D/5G的笼统款）**：
```
款式: 笼统款S（手镯）
总重: 10.5克
按件/按克: 按克
挂签费核算: 10.5 × 13 = 136.50元
```

**按克产品示例3（金条）**：
```
款式: 足金金条
总重: 50克
按件/按克: 按克
挂签费核算: 50 × 5 = 250元
```

## 注意事项

1. 确保Excel文件包含所有必需的列
2. 创建时间列必须是有效的日期格式
3. 过滤会剔除大量数据，请确认过滤规则
4. 输出文件会覆盖同名文件，请注意备份

## 更新日志

- 2025-12-24: 初始版本，支持门店过滤、单据过滤、品类过滤、按件按克判断、挂签费核算
