# 货盘需求计算器

自动计算门店补货需求量的Excel处理工具。

## 功能特性

- ✅ 自动识别门店分组（基于合并单元格）
- ✅ 智能筛选符合条件的数据行
- ✅ 双重计算规则（缺货/有货）
- ✅ 完整保留原表格式和公式
- ✅ 批量处理多门店数据

## 快速开始

### 准备工作

确保你的Excel文件符合以下结构：
- **第6行**：门店名称（合并单元格）
- **第7行**：列标题（包含"库存"、"在途"、"销售"、"需求"）
- **第8行起**：数据行
- **B列**：大类（如"足金"、"足金（新）"）
- **CI列**：补单数量

### 使用示例

直接向Claude提供文件路径即可：

```
/Users/nanyu/Desktop/货盘数据57.7.xlsx
帮我计算补货需求
```

或者：

```
处理这个货盘文件，计算足金和足金（新）的补单需求
```

## 计算规则详解

### 筛选条件

1. **大类筛选**（B列）：
   - 足金
   - 足金（新）

2. **补单数量筛选**（CI列）：
   - 补单数量 > 0

### 需求计算公式

对于每个符合条件的SKU，按门店计算需求：

```
差值 = 库存 + 在途 - 销售

如果 差值 < 0:
    需求 = |差值| × 2
如果 差值 ≥ 0:
    需求 = 1
```

**注意**：忽略销售 ≤ 0 或为空的门店

### 计算示例

| 门店 | 库存 | 在途 | 销售 | 差值 | 需求 |
|------|------|------|------|------|------|
| A店  | 5    | 2    | 10   | -3   | 6    |
| B店  | 8    | 3    | 5    | 6    | 1    |
| C店  | 0    | 0    | 0    | -    | -    |

说明：
- A店缺货3件，需求=3×2=6
- B店有货6件，需求=1
- C店销售为0，忽略

## 文件说明

- `SKILL.md` - Skill配置和描述
- `README.md` - 使用说明文档
- `calculate_demand.py` - 核心处理脚本
- `requirements.txt` - Python依赖项

## 依赖项

```
openpyxl>=3.0.0
```

安装方法：
```bash
pip3 install openpyxl
```

## 输出说明

处理后的文件会保存到原文件所在目录，文件名格式：
```
原文件名_处理后.xlsx
```

例如：
```
货盘数据57.7.xlsx  →  货盘数据57.7_处理后.xlsx
```

## 技术特点

1. **格式保留**：
   - 使用openpyxl保持单元格格式
   - 保留所有原有公式
   - 保留合并单元格结构

2. **性能优化**：
   - 只处理符合条件的行
   - 批量写入数据
   - 智能跳过无效门店

3. **数据安全**：
   - 生成新文件，不修改原文件
   - 自动验证数据类型
   - 错误处理机制

## 常见问题

**Q: 处理时间很长？**
A: 大型文件（4000+行）可能需要1-2分钟，请耐心等待。

**Q: 为什么某些门店没有填写需求？**
A: 如果门店的销售数据 ≤ 0 或为空，会被自动忽略。

**Q: 可以修改计算规则吗？**
A: 可以编辑 `calculate_demand.py` 中的计算逻辑。

**Q: 支持其他品类吗？**
A: 默认只处理足金和足金（新），可以修改代码中的筛选条件。

## 更新日志

### v1.0.0 (2024-12-23)
- ✨ 初始版本
- ✅ 支持足金/足金（新）筛选
- ✅ 基于库存、在途、销售的需求计算
- ✅ 自动识别门店分组
- ✅ 完整保留原表格式

## 作者

Created by Claude with ❤️

## 许可证

MIT License
