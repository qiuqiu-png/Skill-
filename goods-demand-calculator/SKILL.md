---
name: goods-demand-calculator
description: 根据库存、在途、销售数据自动计算门店补货需求量。当用户需要处理货盘数据、货盘文件、计算补单需求、补货需求、库存需求分析、门店需求计算、21天周期补单、足金补单、DIY商品需求或需要填充需求列时使用。支持普通商品和DIY商品差异化计算。
---

# 货盘需求计算器

自动计算门店补货需求量，基于库存、在途、销售数据进行智能分析，支持普通商品和DIY商品的差异化计算规则。

## 功能说明

这个skill可以处理货盘Excel数据文件，根据以下规则自动计算每个门店的补货需求：

### 1. 筛选条件

- **B列（大类）** = 足金 或 足金（新）
- **G列（周期类型）** = 21天周期
- **CI列（补单数量）** > 0

### 2. 门店分组

- 根据第6行的合并单元格自动识别门店分组
- 在DS~YD列范围内查找所有门店
- 每个门店占4列：库存、销售、在途、需求

### 3. 需求计算规则

#### 普通商品（E列二级分类 ≠ DIY）

- 当 `库存 + 在途 - 销售 < 0`：需求 = `|库存 + 在途 - 销售|`
- 当 `库存 + 在途 - 销售 = 0`：需求 = `1`
- 当 `库存 + 在途 - 销售 > 0`：不填充

#### DIY商品（E列二级分类 = DIY）

- 当 `库存 + 在途 - 销售 < 0`：
  - 如果 **CI列补单数量 > 500**：需求 = `|库存 + 在途 - 销售| × 5`
  - 如果 **CI列补单数量 ≤ 500**：需求 = `|库存 + 在途 - 销售| × 2`
- 当 `库存 + 在途 - 销售 = 0`：需求 = `1`
- 当 `库存 + 在途 - 销售 > 0`：**仅当销售 > 1时**，需求 = `1`

### 4. 特殊处理

- **忽略销售 ≤ 0 或为空值的门店**（这些门店不计算需求）
- 保留原表所有公式
- 保留原表所有格式
- 保留原表所有合并单元格

## 使用方法

1. 准备好货盘数据Excel文件
2. 提供文件路径给Claude
3. 脚本会自动处理并生成新文件（文件名添加"_处理后"后缀）

## 示例

```
输入文件: /Users/nanyu/Desktop/货盘数据57.7.xlsx
输出文件: /Users/nanyu/Desktop/货盘数据57.7_处理后.xlsx
```

## 依赖项

- openpyxl

## 适用场景

- 珠宝门店货盘管理
- 库存需求分析
- 补单数量计算
- 多门店库存调配
- DIY商品特殊需求计算

## 注意事项

- 确保输入文件包含完整的门店数据结构
- 第6行必须包含门店名称的合并单元格
- 第7行必须包含"库存"、"销售"、"在途"、"需求"列标题（顺序固定）
- 处理大型文件可能需要较长时间，请耐心等待
- DIY商品的补单数量阈值为500
